@model EyelixEyewear_Project.Models.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<header>
    <h2>Dashboard</h2>
    <div class="header-right">
        <div class="user-wrapper">
            <span style="margin-right: 10px; color: #64748b;">Welcome, <strong>@User.Identity.Name</strong></span>
            <img src="~/images/logo/eyelix-logo.png" alt="Admin" width="40px" style="border-radius: 50%;">
        </div>
    </div>
</header>

<div class="filters" style="margin-bottom: 20px;">
    <select id="periodFilter" onchange="filterDashboard()">
        <option value="week">This Week</option>
        <option value="month" selected>This Month</option>
        <option value="year">This Year</option>
    </select>
</div>

<!-- Stats Cards -->
<div class="cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="card-single">
        <div>
            <h1>@Model.TotalSales.ToString("#,##0") VND</h1>
            <span>Total Sales</span>
        </div>
        <div><i class="fas fa-dollar-sign" style="font-size: 40px; color: #10b981;"></i></div>
    </div>

    <div class="card-single">
        <div>
            <h1>@Model.TotalOrders</h1>
            <span>Total Orders</span>
        </div>
        <div><i class="fas fa-shopping-bag" style="font-size: 40px; color: #3b82f6;"></i></div>
    </div>

    <div class="card-single">
        <div>
            <h1>@Model.TotalProducts</h1>
            <span>Products</span>
        </div>
        <div><i class="fas fa-glasses" style="font-size: 40px; color: #f59e0b;"></i></div>
    </div>

    <div class="card-single">
        <div>
            <h1 style="color: #ef4444;">@Model.PendingOrders</h1>
            <span>Pending Orders</span>
        </div>
        <div><i class="fas fa-clock" style="font-size: 40px; color: #ef4444;"></i></div>
    </div>
</div>

<!-- Charts & Tables -->
<div class="recent-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
    <!-- Revenue Chart -->
    <div class="card">
        <div class="card-header">
            <h3>Revenue Overview</h3>
        </div>
        <div class="card-body">
            <canvas id="revenueChart" style="max-height: 300px;"></canvas>
        </div>
    </div>

    <!-- Top Products -->
    <div class="card">
        <div class="card-header">
            <h3>Top Products</h3>
        </div>
        <div class="card-body">
            <table>
                <thead>
                    <tr>
                        <td>Product</td>
                        <td>Sold</td>
                    </tr>
                </thead>
                <tbody id="topProductsBody">
                    <tr>
                        <td colspan="2" style="text-align: center; color: #94a3b8;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Recent Orders -->
<div class="card" style="margin-top: 20px;">
    <div class="card-header">
        <h3>Recent Orders</h3>
        <a asp-action="Orders" class="btn-main">View All</a>
    </div>
    <div class="card-body">
        <table>
            <thead>
                <tr>
                    <td>Order #</td>
                    <td>Customer</td>
                    <td>Date</td>
                    <td>Status</td>
                    <td>Total</td>
                </tr>
            </thead>
            <tbody id="recentOrdersBody">
                <tr>
                    <td colspan="5" style="text-align: center; color: #94a3b8;">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // Load dashboard data
        $(document).ready(function() {
            loadTopProducts();
            loadRecentOrders();
            initRevenueChart();
        });

        // Revenue Chart
        function initRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Revenue (VND)',
                        data: [1200000, 1900000, 1500000, 2200000, 1800000, 2400000, 2100000, 2600000, 2300000, 2800000, 2500000, 3000000],
                        borderColor: '#e00d0d',
                        backgroundColor: 'rgba(224, 13, 13, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('vi-VN') + ' VND';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load Top Products
        function loadTopProducts() {
            $.get('/Admin/GetTopProducts', function(data) {
                let html = '';
                if (data.length > 0) {
                    data.forEach(p => {
                        html += `<tr>
                            <td>${p.name}</td>
                            <td><strong>${p.sold}</strong></td>
                        </tr>`;
                    });
                } else {
                    html = '<tr><td colspan="2" style="text-align: center; color: #94a3b8;">No data</td></tr>';
                }
                $('#topProductsBody').html(html);
            });
        }

        // Load Recent Orders
        function loadRecentOrders() {
            $.get('/Admin/GetRecentOrders', function(data) {
                let html = '';
                if (data.length > 0) {
                    data.forEach(o => {
                        const statusClass = o.status.toLowerCase() === 'completed' ? 'completed' :
                                          o.status.toLowerCase() === 'pending' ? 'pending' : 'processing';
                        html += `<tr>
                            <td>#${o.orderNumber}</td>
                            <td>${o.customerName}</td>
                            <td>${new Date(o.orderDate).toLocaleDateString('vi-VN')}</td>
                            <td><span class="status ${statusClass}">${o.status}</span></td>
                            <td>${o.totalAmount.toLocaleString('vi-VN')} VND</td>
                        </tr>`;
                    });
                } else {
                    html = '<tr><td colspan="5" style="text-align: center; color: #94a3b8;">No orders</td></tr>';
                }
                $('#recentOrdersBody').html(html);
            });
        }

        function filterDashboard() {
            const period = $('#periodFilter').val();
            console.log('Filter by:', period);
            // TODO: Implement filter logic
        }
    </script>
}

<style>
    .card-single {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .card-single h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .card-single span {
            font-size: 14px;
            color: #64748b;
        }

    .header-right {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .user-wrapper {
        display: flex;
        align-items: center;
    }
</style>